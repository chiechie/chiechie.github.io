---
title: chapter2.1.1 åŸºäºæ‹“æ‰‘çš„æ ¹å› å®šä½CauseInfer1
author: chiechie
date: 2021-05-21 14:41:39
mathjax: true
tags:
- AIOps
- æ ¹å› åˆ†æ
- å¾®æœåŠ¡
- å›¾æ•°æ®
categories: 
- AIOps
---

## ç›®å½•
- [chapter0 æ¦‚è§ˆ](../AIOps-0-summary/)
- [chapter1 æ•…éšœå‘ç°](../AIOps-1-event-generate/)
	- [chapter1.1 å•æŒ‡æ ‡å¼‚å¸¸æ£€æµ‹](../AIOps-1_1-kpi-detector/)
	- [chapter1.3 æ•…éšœé¢„æµ‹](../AIOps-1_2-fault-prediction/)
	- [chapter1.4 æŒ‡æ ‡å¼‚å¸¸å…³è”](../AIOps-1_4-kpi-correlation/)
	- [chapter1.5 æ—¥å¿—èšç±»](../AIOps-1_5-log-analysis/)
		- [chapter1.5.1 ä½¿ç”¨logmineåŠ å¼ºç‰ˆåšæ—¥å¿—èšç±»](../AIOps-1_5_1-log-analysis_logmine/)
		- [chapter1.5.2 ç¾å›¢æ—¥å¿—èšç±»](../AIOps-1_5_2-log-analysis_meituan/)
- [chapter2 æ•…éšœå®šä½](../AIOps-2-event-analysis/)
	- [chapter2.1 å¾®æœåŠ¡ç³»ç»Ÿçš„æ•…éšœå®šä½](../AIOps-2_1-topo-rca/)
		- [chapter2.1.1 CauseInfer1](../AIOps-2_1_1-topo-rca-causeinfer-notes1/)
		- [chapter2.1.2 CauseInfer2](../AIOps-2_1_2-topo-rca-causeinfer-notes2/)
		- [chapter2.1.3 AIOpsæŒ‘æˆ˜èµ›2020-è·å¥–æ–¹æ¡ˆåˆ†äº«](../AIOps-2_1_3-topo-rca-aiops2020/)
		- [chapter2.1.4 AIOpsæŒ‘æˆ˜èµ›2021-demoæ–¹æ¡ˆ](../AIOps-2_1_4-topo-rca-aiops2021/)
		- [chapter2.1.5 N-Softbei2020æ¯”èµ›](../AIOps-2_1_5-topo-rca-cnsoftbei2020/)
		- [chapter2.1.6 MicroCause](../AIOps-2_1_6-topo-rca-MicroCause)
	- [chapter2.2 å¤šç»´ä¸‹é’»æ ¹å› å®šä½](../AIOps-2_2-multi-dimensional-rca/): æš‚æ— 
	- [chapter2.3 è°ƒç”¨é“¾æ ¹å› åˆ†æ](../AIOps-2_3-trace_rca/)
	- [chapter2.4 æ—¶é—´åºåˆ—å…³è”æ€§åˆ†æ](../AIOps-2_4-metric_event_correlation/)
- chapter3 æ•…éšœæ¢å¤


> CauseInferæ˜¯ä¸€ä¸ªè§£å†³æ•…éšœå®šä½çš„é€šç”¨æ–¹æ¡ˆï¼ŒåŸç†æ˜¯é€šè¿‡åœ¨å†å²æ•°æ®ä¸­å­¦ä¹ å› æœå›¾ï¼Œè¿›è€Œåœ¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œæ¨æ–­å‡ºæ•…éšœæ ¹å› ã€‚
>
> è¿™ç¯‡æ–‡ç« å¯¹æˆ‘è¯´å¤ªéš¾å•ƒäº†ï¼Œä¸»è¦æ˜¯å› ä¸ºæ¶‰åŠå¤§é‡ä¸“ä¸šé¢†åŸŸçŸ¥è¯†ï¼Œæ¯”å¦‚è®¡ç®—æœºç½‘ç»œï¼Œå¾®æœåŠ¡æ¶æ„ç­‰ï¼Œå¯¹è¿™å—ä¸ç†Ÿæ‚‰ï¼Œéœ€è¦è¡¥å¾ˆå¤šåŠŸè¯¾ã€‚
>
> è¾“å‡ºçš„æ–‡ç« åˆ†æˆä¸¤ç¯‡: CauseInferè®ºæ–‡ç¬”è®°1ï¼Œå³æœ¬æ–‡ï¼Œè®²èƒŒæ™¯çŸ¥è¯†å’Œæ¦‚è¦è®¾è®¡ï¼Œä»¥åŠç›´è§‰å‹çš„æè¿°é—®é¢˜å’Œè§£é¢˜æ€è·¯ï¼Œéƒ½æ˜¯ç²—ç²’åº¦çš„ï¼›[CauseInferè®ºæ–‡ç¬”è®°2](https://chiechie.github.io/2021/03/03/technology/causeinfer-notes2/)ï¼Œè®²æ ¸å¿ƒæŠ€æœ¯ç‚¹ï¼Œæ–¹æ¡ˆçš„å®ç°é€»è¾‘ï¼Œæ¶‰åŠåˆ°æ•°å­¦å…¬å¼ã€‚
> 
> åŸåˆ™ä¸Šï¼Œç¬¬ä¸€ç¯‡ä¸ç”¨æŠ€æœ¯èƒŒæ™¯ä¹Ÿèƒ½çœ‹æ˜ç™½ï¼Œé—®é¢˜æ˜¯å•¥ï¼Œè§£é¢˜æ€è·¯æ˜¯å•¥ã€‚ç¬¬äºŒç¯‡å°±æ˜¯ç»™ç®—æ³•äººå‘˜çœ‹çš„ï¼Œè¦å‡ºæ–¹æ¡ˆäº†ï¼Œæ‰€ä»¥è¦è¶Šè¯¦ç»†è¶Šå¥½ã€‚


## åè¯è§£é‡Š

æ¥ï¼Œè¡¥å……ä¸šåŠ¡çŸ¥è¯†

- QPSï¼šQueries Per Secondï¼Œæ¯ç§’æŸ¥è¯¢æ¬¡æ•°
- SLA ï¼ˆservice level agreementï¼‰:æœåŠ¡ç­‰çº§åè®®ã€‚æŒ‡çš„æ˜¯æ•´ä¸ªåè®®ï¼Œåè®®çš„å†…å®¹åŒ…å«äº†SLIï¼ŒSLOä»¥åŠæ¢å¤çš„æ–¹å¼å’Œæ—¶é—´ç­‰ç­‰ä¸€ç³»åˆ—æ‰€æ„æˆçš„åè®®ã€‚
- SLIï¼ˆservice level indicatorï¼‰:æœåŠ¡ç­‰çº§å¯¹è±¡ã€‚æŒ‡çš„æ˜¯å¯¹è±¡ï¼Œä¾‹å¦‚ï¼šqpsï¼Œå“åº”æ—¶é—´ï¼Œå‡†ç¡®æ€§ç­‰
- SLOï¼ˆservice level objectiveï¼‰:æœåŠ¡ç­‰çº§ç›®æ ‡ã€‚æŒ‡çš„æ˜¯ç›®æ ‡ï¼Œä¾‹å¦‚ï¼šqps 99.99% ï¼Œå“åº”æ—¶é—´10msç­‰ã€‚


## å‡ ä¸ªé—®é¢˜

çœ‹å®Œç¬¬ä¸€éä¹‹åï¼Œè¿˜æœ‰å‡ ä¸ªé—®é¢˜

- å› æœå›¾æ˜¯ä»€ä¹ˆï¼Ÿ
  - å› æœå›¾æ˜¯ä¸€ä¸ªä¸¤å±‚åˆ†å±‚çš„å›¾ï¼ˆtwo layered hierarchical causality graphï¼‰ï¼Œå› æœå›¾ = æŒ‡æ ‡å› æœå›¾ï¼ˆåˆ»ç”»å±€éƒ¨çš„ä¾èµ–å…³ç³»ï¼‰ + æœåŠ¡ä¾èµ–å›¾ï¼ˆåˆ»ç”»æ•´ä¸ªä¿¡æ¯è®¾å¤‡çš„ä¾èµ–å…³ç³»ï¼‰ã€‚
  - æœåŠ¡ä¾èµ–å›¾ï¼ˆService Dependency Graphï¼‰ï¼šç²—ç²’åº¦çš„ä¿¡æ¯ï¼Œè¡¨ç¤ºæ¯å°æœºå™¨ä¸Šæ¯ä¸ªæœåŠ¡é—´çš„ä¾èµ–å…³ç³»ï¼Œç”¨äºå®šä½åˆ°æœåŠ¡çº§åˆ«çš„causeã€‚
  - æŒ‡æ ‡å› æœå›¾ï¼ˆMetric Causality Graphï¼‰ï¼šç»†ç²’åº¦çš„ä¿¡æ¯ï¼Œè¡¨ç¤ºè¡¨è¾¾çš„æ˜¯ä¸€å°æœºå™¨ä¸Šï¼Œä¸€ä¸ªæœåŠ¡çš„æŒ‡æ ‡å’Œå¤šä¸ªæœºå™¨ä¹‹é—´çš„æ•…éšœä¼ æ’­å…³ç³»ï¼‰ï¼Œç”¨äºå®šä½åˆ°æ€§èƒ½å¼‚å¸¸çš„çœŸæ­£çš„å…ƒå‡¶ã€‚
    
- æŒ‡æ ‡å› æœå›¾å’ŒæœåŠ¡ä¾èµ–å›¾æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ
  
    æŒ‡æ ‡å› æœå›¾ä¸­çš„èŠ‚ç‚¹ æ˜¯ æœåŠ¡ä¾èµ–å›¾ä¸­çš„èŠ‚ç‚¹ çš„ä¸€ä¸ªå±æ€§

- å› æœå›¾æ˜¯æ€ä¹ˆæ„å»ºï¼Ÿ
  
  ä¸¤ç§æ–¹å¼ç»“åˆï¼šé‡‡é›†è°ƒç”¨é“¾æ„å»ºæ‹“æ‰‘ + æ•°æ®åˆ†æå¾—åˆ°å› æœå…³ç³»
  
- å› æœå›¾æ„å»ºå¥½äº†ï¼Œå¦‚æœåšå› æœæ¨æ–­ï¼Ÿ
  
  æ·±åº¦ä¼˜å…ˆéå†ï¼Œæ‰¾æœ‰æ•…éšœçš„çˆ¶æ¯äº²ï¼Œç›´åˆ°æ‰¾åˆ°æ ¹ç»“ç‚¹ï¼Œæˆ–è€…æ­£å¸¸çš„ä¸Šæ¸¸ã€‚
  
- ä¸€ä¸ªä¸»æœºä¸Šçš„æœåŠ¡ï¼Œæ„å»ºä¸€ä¸ªå› æœå›¾ï¼Ÿ
  
  å¯¹çš„ï¼Œæ¯ä¸ªä¸»æœºä¸Šçš„æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„æŒ‡æ ‡å› æœå›¾ã€‚ ç„¶åè·¨ä¸»æœºçš„æœåŠ¡è°ƒç”¨ï¼Œå°±é æœåŠ¡ä¾èµ–å›¾è¡¨ç¤ºã€‚
  
- å› æœå›¾ä¸­ä¸åŒçš„æœºå™¨IPæ˜¯å¦æ˜¯ä¸åŒçš„èŠ‚ç‚¹ï¼Ÿ
  
  æ˜¯çš„ï¼ŒæœåŠ¡ä¾èµ–å›¾çš„ç²’åº¦æ›´ç»†ï¼Œæ˜¯ä¸€ä¸ªæœºå™¨ä¸Šçš„ä¸€ä¸ªæœåŠ¡æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚

-  ä¸€ä¸ªæœåŠ¡çš„SLOæŒ‡æ ‡æ˜¯æ€ä¹ˆå®šä¹‰çš„ï¼Ÿæœ‰ä»€ä¹ˆè§„åˆ™ï¼Ÿå…¶ä»–æŒ‡æ ‡æ˜¯æ€ä¹ˆé€‰å–çš„ï¼Ÿ
   
  ä¸€èˆ¬æ¥è¯´æ˜¯éœ€è¦å¯¹æ¯ä¸€ä¸ªåº”ç”¨å»å®šåˆ¶åŒ–å®šä¹‰çš„ï¼Œä½†æ˜¯è¿™é‡Œå¯ä»¥ç”¨ä¸€ä¸ªç»Ÿä¸€çš„æŒ‡æ ‡ï¼Œå³æœåŠ¡ç›¸åº”æ—¶é•¿ã€‚   

- æ ¹å› æ¨æ–­çš„æ—¶å€™ï¼Œå¤šä¸ªå› å¯¼è‡´çš„ç»“æœæ€ä¹ˆæ¨æ–­å‡ºæ¥ï¼Ÿ
  
  è¿™ç§å¤æ‚çš„é—®é¢˜è§£å†³ä¸äº†.

- æ ¹å› æ¨æ–­çš„æ—¶å€™ï¼Œå¤šä¸ªæ ¹å› æ€ä¹ˆæ‰“åˆ†ï¼Ÿ
  
  æ‰¾å¼‚å¸¸ç¨‹åº¦æœ€é«˜çš„é‚£ä¸ªæŒ‡æ ‡ã€‚

## é—®é¢˜æè¿°

å…³äºæ€§èƒ½è¯Šæ–­é¢†åŸŸï¼Œä¹‹å‰å¤§éƒ¨åˆ†å·¥ä½œéƒ½å¾ˆç²—ç³™ï¼Œåªæ¶‰åŠå®šä½å¼‚å¸¸ï¼Œä½†æ˜¯æˆ‘ä»¬è§‰å¾—è¿˜åº”è¯¥åŒ…æ‹¬æ ¹å› æ¨æ–­ï¼Œä½¿å¾—è½¯ä»¶ç»´æŠ¤æ›´é«˜æ•ˆï¼Œå¹¶ä¸”æä¾›æ›´æœ‰ç”¨çš„ä¿¡æ¯ç»™è½¯ä»¶bugã€‚

è§£å†³æ‰€æœ‰çš„æ€§èƒ½è¯Šæ–­é—®é¢˜ï¼Œæ²¡æœ‰é“¶å¼¹ï¼ˆsilver bulletï¼‰ã€‚æœ¬æ–‡ä¹Ÿåªæ˜¯è¯Šæ–­æ€§èƒ½é—®é¢˜çš„ä¸€ä¸ªå­é›†ã€‚

å½“reviewå®Œä¸€äº›å¼€æºè½¯ä»¶çš„bugsä¹‹åï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œå¾ˆå¤šbugséƒ½å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬ä»…ä»…è€ƒè™‘é‚£äº›é€ æˆèµ„æºå¼‚å¸¸çš„bugsï¼Œä¾‹å¦‚å¯¼è‡´ç‰©ç†èµ„æºæ¶ˆè€—å¼‚å¸¸ï¼ˆeg CPUï¼‰ æˆ–è€… é€»è¾‘èµ„æºå¼‚å¸¸ï¼ˆeg é”ï¼‰ã€‚

ä¸ºä»€ä¹ˆè¦é€‰æ‹©è¿™äº›bugsï¼Ÿ å› ä¸º ä¸éœ€è¦å…³æ³¨æºä»£ç ï¼Œå°±å¯ä»¥æœé›†èµ„æºæ¶ˆè€—æŒ‡æ ‡ï¼›è½¯ä»¶ä¸­å­˜åœ¨å¤ªå¤šè¿™ç§bugsäº†ã€‚
æˆ‘ä»¬çš„ç›®çš„æ˜¯ï¼Œæ‰¾åˆ°å¯¼è‡´è¿™äº›æŒ‡æ ‡å¼‚å¸¸ï¼ˆcpuæ¶ˆè€—è¿‡å¤šï¼Œdbè¢«é”ï¼‰çš„åŸå› ï¼Œæˆ‘ä»¬ä¸ç›´æ¥è¯†åˆ«è½¯ä»¶bugï¼Œæˆ‘ä»¬æä¾›ä¸€äº›æç¤ºã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬å®šä½åˆ°æ ¹å› æ˜¯ï¼Œé”çš„ä¸ªæ•°å¼‚å¸¸ï¼Œåˆ™å¯èƒ½æ˜¯ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªå¹¶å‘bugã€‚

CauseInferçš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œæ„å»ºä¸€ä¸ªå› æœå›¾ï¼Œæ¥æ•æ‰å› æœï¼ˆcause-effect ï¼‰å…³ç³»ï¼Œç„¶åæ²¿ç€å› æœè·¯å¾„æ¨æ–­å‡ºæ ¹å› ï¼ˆroot causeï¼‰ã€‚
ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼ŒCauseInferè‡ªåŠ¨åŒ–åœ°æ„å»ºäº†ä¸€ä¸ªä¸¤å±‚çš„åˆ†å±‚çš„å› æœå›¾ã€‚

ä¸€æ—¦æœåŠ¡çº§åˆ«ç›®æ ‡ï¼ˆSLOï¼‰å¼‚å¸¸äº†ï¼Œå°±è§¦å‘å› æœæ¨æ–­ã€‚
é¦–å…ˆå°†æ€§èƒ½å¼‚å¸¸å®šä½åˆ°æŸä¸ªæœåŠ¡ï¼ˆegï¼Œtomcatï¼‰ï¼Œé€šè¿‡æ£€æµ‹è¯¥SLOæŒ‡æ ‡æ˜¯å¦å¼‚å¸¸ã€‚
ç„¶åé€šè¿‡æ£€æµ‹åŒä¸€å°æœºå™¨ä¸Šçš„å…¶ä»–æ€§èƒ½æŒ‡æ ‡æ˜¯å¦å¼‚å¸¸ï¼Œæ‰¾åˆ°æ ¹å› ï¼Œ
æ›´è¿›ä¸€æ­¥ä¸ºäº†ä¿è¯æ•ˆæœçš„ç¨³å®šï¼Œæå‡ºäº†çªå˜ç‚¹æ£€æµ‹æ–¹æ³•ï¼ŒåŸºäºè´å¶æ–¯ç†è®º--è¿™ä¸ªæ–¹æ³•æ¯”ä¼ ç»Ÿçš„æ£€æµ‹æ–¹æ³•å¦‚cusumè¦å¥½ã€‚
é€šè¿‡åœ¨ä¸¤ç»„benchmarkï¼ˆOlio å’Œ TPC-W,ï¼‰åšå®éªŒè¯„ä¼°ï¼Œå‘ç°æœ¬æ–¹æ³•å¯ä»¥å®šä½å‡ºæ ¹å› ï¼Œå‡†å¬åˆ†åˆ«æ˜¯80%å’Œ85%ã€‚
æœ¬æ–‡çš„è´¡çŒ®

- æå‡ºäº†ä¸€ä¸ªæ–°çš„BCPçªå˜ç‚¹æ£€æµ‹æ–¹æ³•ï¼Œæ¯”cusumæ›´ç¨³å®šï¼Œåœ¨é•¿æœŸçš„æ•°æ®åºåˆ—ä¸Š
- æå‡ºäº†ä¸€ä¸ªè½»é‡çš„æœåŠ¡ä¾èµ–æ–¹å¼çš„ å‘ç°æ–¹æ³•ï¼Œé€šè¿‡åˆ†æä¸¤ä¸ªæœåŠ¡çš„æµé‡å»¶è¿Ÿï¼Œå¾ˆå¿«å®šä½åˆ°æœåŠ¡çº§åˆ«çš„æ€§èƒ½å¼‚å¸¸ï¼Œ
- æä¾›äº†ä¸€ä¸ªåŸºäºåŸå§‹PC-ç®—æ³•çš„å› æœå›¾æ„å»ºæ–¹æ³•ï¼Œä½¿ç”¨è¿™ä¸ªå› æœå›¾ï¼Œæˆ‘ä»¬è‚¯å‘¢ä¸ªå¾ˆå‡†ç¡®å®šä½åˆ°æ€§èƒ½æŒ‡æ ‡çº§åˆ«çš„æ€§èƒ½é—®é¢˜çš„æ ¹å› ã€‚
- è®¾è®¡å’Œå®ç°äº†CauseInferï¼Œå¯ä»¥æ¨æ–­æ€§èƒ½é—®é¢˜çš„æ ¹å› ï¼Œå¯ä»¥ä»¥è¾ƒå°çš„ä»£ä»·ï¼Œè¾ƒé«˜çš„å‡†ç¡®ç‡æ‰¾åˆ°æ€§èƒ½é—®é¢˜çš„çœŸæ­£æ ¹å› ã€‚


## ç³»ç»Ÿæ¦‚è§ˆ

å…ˆæè¿°CauseInferçš„æ¡†æ¶ï¼Œå¹¶ä¸”é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æè¿°è¿™ä¸ªç³»ç»Ÿçš„å·¥ä½œæµ

###  CauseInferçš„æ¡†æ¶

çœ‹å›¾è¯´è¯--CauseInferçš„æ¡†æ¶

å¯¹äºæ¯ä¸ªèŠ‚ç‚¹-æœºå™¨ï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªæœ¬åœ°çš„å› æœå›¾ï¼Œ
å› æœæ¨æ–­çš„æµç¨‹ åœ¨å‰ç«¯çš„SLOå¼‚å¸¸æ—¶è¢«è§¦å‘ï¼Œç„¶åè¿­ä»£å¾€å¤åœ° æ²¿ç€æœåŠ¡ä¾èµ–å›¾çš„è·¯å¾„ï¼Œè·‘åˆ°åç«¯æœåŠ¡ï¼Œ
å¦‚æœåœ¨æŸä¸ªæœåŠ¡èŠ‚ç‚¹æ£€æµ‹åˆ°SLOå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œæ›´ç²¾ç»†çš„æ¨æ–­ï¼Œ--åœ¨æŒ‡æ ‡ä¾èµ–å›¾ä¸Šã€‚
ã€å›¾1-æ ¹å› åˆ†ææ¡†æ¶ã€‘å±•ç¤ºäº†åŸºæœ¬ç»“æ„å’Œworkflowï¼Œ


- åº•å±‚æ˜¯ä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿçš„ç‰©ç†æ‹“æ‰‘
- é¡¶éƒ¨æ˜¯è¿™ä¸ªä¸šåŠ¡ç³»ç»Ÿå¯¹åº”çš„å› æœå›¾
![å›¾1-æ ¹å› åˆ†ææ¡†æ¶](causeinfer_framework.jpeg)
- å¤§è™šçº¿åœ†åœˆè¡¨ç¤ºæœåŠ¡
- çº¢è‰²èŠ‚ç‚¹è¡¨ç¤ºæ ¹æœ¬åŸå› ï¼Œ
- é»‘è‰²èŠ‚ç‚¹è¡¨ç¤ºæ€§èƒ½æŒ‡æ ‡ï¼Œ
- ç»¿è‰²èŠ‚ç‚¹è¡¨ç¤º SLO æŒ‡æ ‡ï¼Œ
- ç®­å¤´è¡¨ç¤ºæ–¹å‘ æ•…éšœä¼ æ’­ã€‚
- å›¾ä¸­çš„æœ‰å‘è¾¹ä»£è¡¨çš„æ„æ€æ˜¯ï¼Œå› æœå…³ç³»

### ä¸¾ä¸ªğŸŒ°æ¼”ç¤ºå·¥ä½œæµ

å‡è®¾æœåŠ¡IIèŠ‚ç‚¹ä¸­çš„æŒ‡æ ‡ E æ˜¯æ ¹å› 

- å½“æ£€æµ‹åˆ°æœåŠ¡ I çš„ SLO å¼‚å¸¸æ—¶ï¼Œè§¦å‘åŸå› æ¨æ–­
- å¯¹æœåŠ¡ I èŠ‚ç‚¹è¿›è¡Œæ ¹å› åˆ†æï¼Œå®šä½æ ¹å› æ˜¯æŒ‡æ ‡Aï¼ŒAå°±æ˜¯æœåŠ¡IIçš„SLOæŒ‡æ ‡
- å› æ­¤ï¼ŒæœåŠ¡IIä¸­çš„æ ¹å› åˆ†æè¢«è§¦å‘ï¼Œåœ¨æœåŠ¡IIåœ¨çš„æœºå™¨ä¸­ï¼ŒåŠ è½½å‡ºç›¸åº”çš„æœåŠ¡æŒ‡æ ‡ä¾èµ–å›¾ï¼ŒæœåŠ¡Iä¸­çš„æŒ‡æ ‡Aå¼‚å¸¸å¯èƒ½æ˜¯æœåŠ¡IIçš„SLOå¼‚å¸¸å¯¼è‡´ã€‚
- å› æ­¤ä¼šç»§ç»­åœ¨æœåŠ¡IIä¸­è§¦å‘å› æœæ¨æ–­ï¼Œè¿™é‡Œç”¨åˆ°è¯¥æœºå™¨çš„æŒ‡æ ‡å› æœå›¾ã€‚
- æ€»ç»“ï¼šæœ€åæˆ‘ä»¬æ‰¾åˆ°äº†æ ¹å› --æŒ‡æ ‡Eï¼Œ æ¨æ–­è·¯å¾„ä¸ºï¼šSLOï¼ˆservice II ï¼‰ â†’ Aï¼ˆservice II ï¼‰ â†’ Dï¼ˆservice IIï¼‰ â†’ Eï¼ˆservice IIï¼‰

![å›¾2example](./eample1.png)

å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¨æ–­ç»“æœåŒ…å«å¤šä¸ªæ ¹å› ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæ’åºçš„æ­¥éª¤é€‰æ‹©æœ€å¯èƒ½çš„æ ¹å› ï¼Œ æ¥é™ä½è¯¯å‘Šã€‚

## ç³»ç»Ÿç»†èŠ‚

CauseInferåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šç¦»çº¿å’Œåœ¨çº¿ã€‚

åœ¨çº¿é˜¶æ®µåŒ…æ‹¬ä¸¤ä¸ªæ¨¡å—ï¼Œæ•°æ®æ”¶é›†å’Œå› æœæ¨æ–­ã€‚

- æ•°æ®æ”¶é›†æ¨¡å—ï¼Œæ”¶é›†äº†è¿è¡Œçš„æ€§èƒ½æŒ‡æ ‡--å¤šä¸ªæ•°æ®æºã€‚
- å› æœæ¨æ–­æ¨¡å—ï¼Œè´Ÿè´£å› æœå›¾éå†å’Œå¯¹æ ¹å› è¿›è¡Œæ’åºã€‚

ç¦»çº¿é˜¶æ®µåŒ…æ‹¬ä¸¤ä¸ªæ¨¡å—--å˜ç‚¹æ£€æµ‹å’Œå› æœå›¾æ„å»º

- å˜ç‚¹æ£€æµ‹ï¼šå°†æŒ‡æ ‡è½¬åŒ–ä¸º0/1çš„äºŒå€¼åºåˆ—ï¼Œä½¿ç”¨çš„æ˜¯è´å¶æ–¯å˜ç‚¹æ£€æµ‹ã€‚
- å› æœå›¾æ„å»ºï¼šä½¿ç”¨äºŒå€¼æŒ‡æ ‡æ¥æ„å»ºä¸€ä¸ª2å±‚çš„å±‚æ¬¡åŒ–çš„å› æœå›¾ã€‚


### Aï¼šæ•°æ®æ”¶é›†

æ•°æ®æ”¶é›†æ¨¡å—ï¼Œæ”¶é›†é«˜ç»´åº¦è¿è¡Œä¿¡æ¯ï¼Œä»å¤šä¸ªæ•°æ®æºï¼Œæ¨ªè·¨å¤šä¸ªä¸åŒçš„è½¯ä»¶æ ˆï¼ŒåŒ…æ‹¬åº”ç”¨ï¼Œè¿›ç¨‹ å’Œ æ“ä½œç³»ç»Ÿã€‚

åœ¨å› æœå›¾æ„å»ºé˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåº”ç”¨çš„SLOæŒ‡æ ‡ã€‚ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨éƒ½æ˜¾ç¤ºåœ°æä¾›SLOæŒ‡æ ‡ï¼ˆä¾‹å¦‚mysqlï¼Œhadoopï¼‰ï¼Œ
å¹¶ä¸”ï¼Œä¸åŒåº”ç”¨ä¸­SLOå¯¹åº”ä¸åŒæŒ‡æ ‡ã€‚å› æ­¤æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°çš„ç»Ÿä¸€çš„SLOæŒ‡æ ‡--tcpè¯·æ±‚å»¶è¿Ÿï¼Œç®€ç§°ä¸ºTCP LATENCYã€‚
TCP LATENCY è¡¡é‡çš„æ˜¯æŸä¸ªç«¯å£ï¼Œ æœ€åä¸€ä¸ªå…¥ç«™åŒ…ï¼ˆè¯·æ±‚ï¼‰å’Œç¬¬ä¸€æ¬¡å‡ºç«™åŒ…ï¼ˆå“åº”ï¼‰çš„æ—¶é—´é—´éš”ã€‚
å¤§éƒ¨åˆ†åº”ç”¨éƒ½æ˜¯ç”¨TCPä½œä¸ºä¼ è¾“åè®®ï¼Œä¾‹å¦‚ Mysql, Httpdç­‰ï¼Œå› æ­¤TCPå»¶è¿Ÿï¼Œå¯ä»¥ä½œä¸ºå¤§éƒ¨åˆ†åº”ç”¨çš„SLOæŒ‡æ ‡ã€‚

### B: å˜ç‚¹æ£€æµ‹
æ ¹æ®Pearlçš„å› æœï¼ˆcause-effectï¼‰[7]æ¦‚å¿µï¼Œå¦‚æœæœ‰ä¸¤ä¸ªå˜é‡æœ‰å› æœå…³ç³»ï¼Œä¸€ä¸ªå˜é‡çš„å˜åŒ–å°†å¯¼è‡´å¦ä¸€ä¸ªå˜åŒ–ã€‚å› æ­¤ï¼Œåœ¨æ„å»ºå› æœå›¾ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆç¡®å®šæ—¶é—´åºåˆ—ä¸­çš„å˜åŒ–ã€‚ä¸€èˆ¬é‡‡ç”¨CUSUM [4]æ¥æ£€æµ‹çªå˜ç‚¹ï¼Œ
ä½†æ˜¯ç”±äºå¯¹å™ªå£°çš„é«˜æ•æ„Ÿæ€§ï¼ŒCUSUMå¾ˆéš¾æ£€æµ‹å‡ºé•¿æœŸçš„å˜åŒ–ï¼Œå¯¼è‡´ç¦»çº¿åˆ†æçš„é«˜è¯¯è­¦ã€‚å› æ­¤æˆ‘ä»¬å¼•å…¥äº†æ›´æœ‰æ•ˆçš„æ–¹æ³•ï¼Œè´å¶æ–¯å˜ç‚¹æ£€æµ‹ï¼ˆç¼©å†™ä¸ºBCPï¼‰[8]

BCPçš„åŸºæœ¬æ€æƒ³æ˜¯æ‰¾åˆ°ä¸€ä¸ªunderlying å‚æ•°åºåˆ—ï¼Œå°†æ—¶é—´åºåˆ—åˆ’åˆ†ä¸ºè¿ç»­çš„blocksï¼Œæ¯ä¸ªblocksçš„å‚æ•°ä¸€æ ·
çªå˜ç‚¹çš„ä½ç½®ï¼Œå°±æ˜¯æ¯ä¸ªblockçš„è¾¹ç¼˜ã€‚
ã€‚ç»™å®šä¸€ä¸ªè§‚å¯Ÿåºåˆ—ï¼šX =ï¼ˆx1ï¼Œx2ï¼ŒÂ·Â·Â·ï¼Œxnï¼‰ï¼Œç›®çš„æ˜¯
æ‰¾åˆ°ä¸€ä¸ªåˆ†åŒºï¼šÏ=ï¼ˆP1ï¼ŒP2ï¼ŒP3ï¼ŒÂ·Â·Â·ï¼ŒPn-1ï¼‰ï¼Œ
å…¶ä¸­Pi = 1 è¡¨ç¤ºåœ¨ä½ç½®i + 1å¤„å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦åˆ™Pi = 0ã€‚
å…³äºBCPçš„è¯¦ç»†ç†è®ºåˆ†æå‚è€ƒè®ºæ–‡[8]ã€‚ä¸CUSUMæ–¹æ³•ç›¸æ¯”ï¼ŒBCPä¸éœ€è¦è®¾ç½®çªå˜ç‚¹ä¸ªæ•°ï¼Œä»¥åŠåŸå§‹åºåˆ—ä¸­groupä¸ªæ•°ã€‚

BCPæ•ˆæœæ›´å¥½ï¼Œæ›´é€‚åˆåˆ†æé•¿åºåˆ—ï¼Œä½†æ˜¯ä¸é€‚åˆåœ¨çº¿æ¨¡å¼ï¼Œ
æ‰€ä»¥æˆ‘ä»¬ä»é‡‡ç”¨CUSUMä½œä¸ºåœ¨çº¿çš„å˜ç‚¹æ£€æµ‹æ–¹æ³•ã€‚

### C: å› æœå›¾æ„å»º

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°ä¸¤å±‚çš„åˆ†å±‚å› æœå›¾ï¼ˆå³æœåŠ¡ä¾èµ–å›¾å’Œ æ€§èƒ½æŒ‡æ ‡å› æœå›¾ï¼‰æ„å»ºè¿‡ç¨‹ã€‚
åœ¨collectiveå˜é‡ä¸­ï¼Œå¦‚æœYçš„æ‰€æœ‰çˆ¶æ¯å·²ç»å›ºå®šçš„ï¼ŒYçš„åˆ†å¸ƒå°†æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”ä¸å—å…¶ä»–å˜é‡å½±å“ã€‚åœ¨è¿™ç§å› æœå…³ç³»ä¸­ï¼Œ ä¸å…è®¸ä¸¤ä¸ªå˜é‡äº’ä¸ºå› æœã€‚æ‰€ä»¥å› æœå…³ç³»å¯ä»¥ç”±DAGè¿›è¡Œç¼–ç ã€‚

è¯¦ç»†çš„æœåŠ¡ä¾èµ–å›¾ å’Œ æ€§èƒ½ä¾èµ–å›¾ çš„æ„å»ºï¼Œå‚è€ƒ[CauseInferè®ºæ–‡ç¬”è®°2](https://chiechie.github.io/2021/03/03/technology/causeinfer-notes2/)


## æŠŠç¦»çº¿å’Œåœ¨çº¿ä¸²èµ·æ¥

### ç¦»çº¿åˆ†æ

åœ¨ç¦»çº¿é˜¶æ®µï¼Œæ„å»ºå› æœå›¾ï¼ˆcausality graphï¼‰:

- æ„é€ æœåŠ¡ä¾èµ–å›¾åˆ†ä¸ºä¸¤æ­¥ï¼š
  - ç¬¬ä¸€æ­¥é€šè¿‡é‡‡é›†å™¨è·å–è¾¹æ˜¯å¦å­˜åœ¨ï¼›
  - ç¬¬äºŒæ­¥é€šè¿‡åˆ†æä¸¤ä¸ªæœåŠ¡é—´çš„é€šä¿¡å»¶è¿Ÿç›¸å…³æ€§ï¼ˆtraffic lag correlationï¼‰æ¥è¿›ä¸€æ­¥ç¡®å®šè¾¹çš„æ–¹å‘ã€‚
- æœåŠ¡ä¾èµ–å›¾ä¸­çš„èŠ‚ç‚¹æ€ä¹ˆå®šä¹‰ï¼ŸäºŒå…ƒç»„ (ip, service name)
  
  > æœ‰çš„æ–‡ç« ç”¨3å…ƒç»„(ip, port, proto)è¡¨ç¤ºï¼Œprotoæ˜¯ä¼ è¾“åè®®çš„ç±»å‹ï¼Œæ¯”å¦‚TCPæˆ–è€…UDPã€‚
  > 
  > è€ƒè™‘åˆ°ä¸€ä¸ªæœåŠ¡å¯èƒ½å ç”¨å¤šä¸ªç«¯å£, é‡‡ç”¨è¿™ç§æ–¹å¼å°±ä¼šå¯¼è‡´å›¾çš„èŠ‚ç‚¹éå¸¸å¤šï¼Œä½†æ˜¯å¯¹æ ¹å› å®šä½å…¶å®æ²¡æœ‰å¾ˆå¤§çš„ç”¨å¤„ã€‚
  > 
  > ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ªä¸‰å±‚çš„ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªweb serverå¯ä»¥é€šè¿‡ä»»æ„ä¸€ä¸ªç«¯å£è®¿é—®application serverçš„ã€‚å¦‚æœä½¿ç”¨ç«¯å£ä½œä¸ºæœåŠ¡çš„å”¯ä¸€å±æ€§ï¼Œè¿™ä¸ªæœåŠ¡ä¾èµ–å›¾å°±ä¼šå˜å¾—éå¸¸å¤§ï¼Œå³ä½¿æ‰€æœ‰è¯·æ±‚éƒ½æ˜¯ç”±åŒä¸€ä¸ªæœåŠ¡å‘èµ·çš„ã€‚

### åœ¨çº¿æ¨æ–­

åœ¨å®æ—¶é˜¶æ®µï¼Œä½¿ç”¨å› æœå›¾ï¼ˆcausality graphï¼‰æ¥åšæ ¹å› æ¨æ–­ï¼Œå¾—åˆ°å¯èƒ½çš„åŸå› åˆ—è¡¨ã€‚

![å›¾1-æ ¹å› åˆ†ææ¡†æ¶](./img.png)

## è¯„ä¼°

æˆ‘ä»¬è§£å†³çš„æ˜¯ä¸€ä¸ªå› æœæ¨æ–­çš„é—®é¢˜ï¼Œå› æ­¤å¸¸ç”¨çš„ç»Ÿè®¡å­¦çš„è®¾è®¡å®éªŒçš„æ€è·¯åœ¨è¿™é‡Œè¡Œä¸é€šã€‚


## å‚è€ƒæ–‡çŒ®

1. [2014-INFOCOM_CauseInfer](https://netman.aiops.org/~peidan/ANM2016/RootCauseAnalysis/ReadingLists/2014INFOCOM_CauseInfer.pdf)
2. [2007-The Journal of MachineLearning Research-pcç®—æ³•](https://www.jmlr.org/papers/volume8/kalisch07a/kalisch07a.pdf)
3. [åˆ«äººå¯¹CauseInferè®ºæ–‡çš„è§£è¯»](https://saruagithub.github.io/2020/04/13/20200413CauseInfer%E8%AE%BA%E6%96%871/)
4. [CauseInferè®ºæ–‡ç¬”è®°2](https://chiechie.github.io/2021/03/03/technology/causeinfer-notes2/)
5. J. Pearl, Causality: models, reasoning and inference. Cambridge Univ Press, 2000, vol. 29.
6. D. Barry, â€œA bayesian analysis for change point problems,â€ Journal of the American Statistical Association, vol. 88, no. 421, pp. 309â€“319, 1993.