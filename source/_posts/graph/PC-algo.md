---
title: PC算法
author: chiechie
mathjax: true
date: 2021-03-09 10:06:00
tags:
- 因果推断
- 因果分析
- 贝叶斯
- 根因分析
categories: 
- 图
---

# 背景

学术界有两种对因果关系建模的方法：因果图和结构方程。
对于构建因果图，目前使用的最多的是PC算法。

通过观察N个独立同分布的样本，来挖掘随机变量的之间的因果关系。
每个样本都是来自M个随机变量的1组观测值。

有点类似机器学习中，使用随机森林去学习特征的相关性。特征就类似因果图中的节点，也就是随机变量。

##  基本概念

- 因果图：因果模型的一种表达方式，因果图是一个DAG， G=（V，E），对于每一个节点v，给定了他的双亲pa（v），v跟所有非后代都是独立的。
- 冲撞点（collider）：一种V型结构的因果图. 两个因导致一个果。
- 马尔科夫条件：可用来区分因果关系和相关关系，被用于生成依赖关系集合，构造因果图框架。
- faithfulness假设：可以用来保证，V中的所有变量的独立关系，都可以通过D-seperation表达。
- PC算法的两个假设：马尔可夫条件和faithfulness。

D-分离

> D分离（D-Separation）是一种用来判断两个变量是否条件独立的图形化方法，相比于非图形化方法，更加直观，且计算简单。 

定义: 设 X，Y，Z 是 DAG 中不相交的节点集合， $\pi$ 为一条连接 X 中某节点到 Y 中某节点的路径 （不管方向）。 如果路径 $\pi$ 上某节点满足如下的条件：

1. 在路径$\pi$上，w 点处为 V结构 , 即$X \rightarrow w \leftarrow Y$，且 w 及其后代不在 Z中；(因为collider关系，w不可观测时,X,Y 相互独立)
2. 在路径$\pi$上，w 点处为 非V结构 ，且w在Z中 。

则称Z阻断了路径$\pi$。 

如果Z阻断了所有的X到Y的路径，就说Z集合D分离了X和Y，记作$(X \perp Y \mid Z)_{G}$.


# PC算法-概览

PC算法输入N个m维的样本，输出一个有向无环图（DAG），
举个例子，如果要构建一个故障因果图，一个指标就是图中的一个节点，每个时间点的观测值，就是一个样本。
如果给定一个变量集合，S，A和B独立，即 A ⊥ B|S，那么A和B两个节点就没有边。

PC算法分为四步:

1) 构建一个全连接图，M个随机变量就对应M个节点
2) 条件独立性检验：对于每一组相邻的节点，给定置信度$\alpha$, 如果条件独立，那么两个变量之间的边就remove掉。
   条件变量S的大小每次迭代递增，直到没有多余的变量可以被加入S
3) 基于v-structure确定边的方向.
4) 确定剩下的边的方向，传播.

PC算法是一种发现因果关系的算法，在满足一定的假设的前提下（基于马尔科夫条件 和 D-separation），使用基于统计的方法（显著性检验-$G^2$），推导出因果关系（代表因果关系的DAG）。实现流程包括三步:

![图1-PC算法](pc-overview.png)

## 条件独立性检验

从全连接图开始，移走条件独立的边

![图2-确定框架](pc1.png)

Z从空集开始，不断增加

具体来说，可以用指标$G^2$（条件交叉熵）来检验给定Z时，X和Y的独立性，这里X，Y，Z是互斥的。

$G^{2}=2 m C E(X, Y \mid Z)$

- m：样本大小
- $ C E(X, Y \mid Z)$:给定Z时，X和Y的条件交叉熵，

> 显著性低于0.05，就说明条件分布和联合分布没有显著性差异，有因果关系
> 显著性超过0.05， 就说明条件分布和联合分布没有显著性差异，没有因果关系，是独立的。

如果$G^2$超过一个预先设定的显著性，比如0.05， 那么X和Y是条件独立的。

PC算法使用一个全连接的无向图，然后使用$G^2$描述条件独立性。


## 确定边的方向

当DAG的架子搭起来了， 接下来的工作就是决定因果关系的方向了。这里使用到了D-seperation的方法。 

![图3-确定方向](pc2.png)

## 传播方向

![图4-传播方向](pc3.png)


# 参考

1. [2007-The Journal of MachineLearning Research-pc算法](https://www.jmlr.org/papers/volume8/kalisch07a/kalisch07a.pdf)
2. [pc算法-youtube](https://www.youtube.com/watch?v=o2A61bJ0UCw)
3. [因果图的基本概念-知乎](https://zhuanlan.zhihu.com/p/269625734)
4. [Page,3-paper](https://netman.aiops.org/wp-content/uploads/2020/06/%E5%AD%9F%E5%AA%9B.pdf)