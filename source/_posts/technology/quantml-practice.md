---
title: 时序预测最佳实践
author: chiechie
mathjax: true
date: 2021-06-05 00:06:21
tags: 
- 最佳实践
- 人工智能
- 时序预测
- 量化交易
categories: 
- 技术
---


# 建模pipeline

1. 搜集原始数据:数据是间断的：交易日有，交易日的固定时间段有，节假日没有数据
2. 选择样本区间:选择交易日的，交易日的
3，对选好的数据进行采样，并不能保证每天都有整数个点
4，切分训练集 & 验证集
5，模型训练
    - 归一化训练集，<x， target>
    - 训练
6. 模型评估
    - 归一化验证集
    - 预测
    - 画图：
        - 一个预测样本（gluonTS直接可用，keras目前不支持）
            - 多个lead
        - 多个预测样本
            - 1个lead


实践过程中遇到的一些问题，需要逐一解决，下面记录其中一些

# 问题集合

## 问题1：采样和数据选择在整个流程中的哪个位置？

- １. 采样，且缺失值填０
- ２．初筛：按照固定时间段（９：３０－１５：３０），对数据进行筛选
- ３．继续筛选: 找到那些有效交易数据较少的日子，把这些日子的数据都扔掉
    - 优点：对不等间隔的数据 也能处理
    - 缺点：比较麻烦

    
## 问题2： 调参集的mse比训练集低，但相关系数训练集远远大于调参集，这是有bug？

没有bug，mse和correlation评估的侧重点不一样。

mse小，但是correlation也小的例子，如下图：

![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2Frf_learning%2FNUSWvXNmWb.png?alt=media&token=8c03a9f3-60e1-424d-879e-3371c1516623)

原因：
- 欧式距离（mse）量化的 是两个实体（或者两个群体）之间的绝对物理距离
- 余弦距离（correlation）量化的是 两个实体（或者两个群体）相对原点的角度距离
- 余弦距离 和 pearson 相关稀疏的 区别： pearson衡量的是 两个变量 之间的 线性关系，具体做法是 使用一个直线去拟合多组样本点<变量1，变量2> ，直线斜率就是 相关关系

## 问题3：对于时序预测中尤其常见的分布漂移的问题，怎么解决？

使用滑动窗口的均值来 做中心化

## 问题4：还有哪些措能提升实验效果？

取效果好和效果差的两组实验进行对比和quantML效果对比，排查效果提升的因素：

观察到1个现象：使用短期趋势中心化后，在使用长期趋势归一化，能使效果变好，背后的理论依据是什么？

分析下原因：因为用到了更长的历史数据作为参考,本身模型是记不住 那么长的历史信息的。（输入才半个小时）

![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2Frf_learning%2Fg6FAdLzkOj.png?alt=media&token=362ed41e-1773-4ff5-ac41-a3095f75bb86)

参考: [doc](https://github.com/Arturus/kaggle-web-traffic/blob/master/how_it_works.md)

## 问题5： 过拟合的原因
训练集 的比例远大于 验证集 和测试集

## 问题6： 是不是预测的准就能挣钱了？

不是，回测的时候要考虑滑点，交易费用，爆仓风险

## 问题7：同样一个预测模型（LSTM），商品期货准确率比股指差这么多？

- 因为1min的股指期货数据平滑，噪声少，而1min的商品期货毛刺非常多
- 将1min的商品期货聚合成5min之后，再使用过去1h的数据预测未来1h的数据，准确率非常之高

## 问题8：直接用回归模型预测价格，可能有负数怎么处理

预测增长率

## 问题9：除了直接回归，还有哪些方法？

转化为分类问题，换预测涨跌幅

