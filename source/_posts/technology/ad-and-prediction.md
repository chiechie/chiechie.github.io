---
title: 预测和异常检测
author: chiechie
mathjax: true
date: 2021-04-01 23:12:28
tags:
- 时间序列
- 不相容需求
- 趋势回归
- 
categories:
- 技术
---

> 一些reflection

## 公理

1. 异常检测比预测的任务更简单，异常检测只需自圆其说即可，时序预测需要拿现实数据来验证。
2. 异常检测分两步走，先做模式识别，也就是找规律，然后判断未来的数据是不是符合这个规律，不符合就是异常符合就是正常。


## 推论

1. 异常检测只需要告知自己理解是啥，预测需要更进一步，考虑现实中的最有可能发生的情况。
2. 异常检测的原理是历史外延，没法证伪。具体一点，如果预测和现实有偏差，如果能找到故障，好说。如果找不到，也有可能是隐患，或者我们的观察视角有局限。没法证明是误判。
3. 一种异常检测器是一种观测的视角，代表了一种对未来的预判的模式。是允许存在多个视角的，并且应允许自由切换。
4. 做异常检测是学术界的事情，自己设置前提条件，自己推导结论。
5. 做预测是企业家的事情，有风险。
6. 多重空间可推导，人给不出一个确定的预测结果。（反证法）
7. 异常检测可以大胆地做，理论上没法证伪，能自圆其说即可。
8. 什么样的说法用户可接受？符合他们认知的说法可接受。就是同环比了。


## 时间序列和iid样本
1. 时间序列相对于一般的独立同分布的样本生成机制不一样，所以遵循的的宏观规律也不一样。时间序列比如人在不同时刻的行为序列，是有延续的。iid的序列比如，体育彩票，每一期中奖号码跟上一期没有关系。
2. iid的样本，整体上是符合大数定律和中心极限定理。时间序列分布很明显就不是，样本之间的关系还粘粘乎乎的。
3. 使用大数定律套到时间序列上面行不行？即，如果新来的样本点不满足历史的所有样本的正态分布，就说是异常。
要回答这个问题，需要先看能否找到两个反例：

	1. 反例1：新来的样本不满足正态分布，但是正常？有，周期性凸起
	2. 反例2：新来的样本满足正态分布，但是异常？有，局部拐点

4. 还是想补救一下，能不能认为，排除掉了周期性凸起和局部拐点之后，就满足大数定律了？
5. 或者切换到一个更简单清晰的视角，能不能不用大数定律，而是从时间序列的角度出发，找到时间序列模本身的一些规律？先提出几个假设

	1. stl模式：假设时间序列是由周期性 + 趋势性 + 高斯噪声 三部分组成。在历史数据中分解出这3种模式。假设趋势性保持，周期性往复，高斯噪声依旧无规律，生成一个预测区间。然后拿新样本去对比。

	> chiechie点评：这种方法很好，但是要验一下，周期性凸起能否避免，局部拐点能否告出。
	>
	> 我猜测还是有那个问题，给的置信区间太大了，局部拐点告不出来。周期性凸起应该还是能避免的。

	2. 环比 + 同比：一个策略检测环比（检测突升突降），一个策略检测同比（屏蔽周期性告警）。



## 周期性凸起和局部拐点是不是两个不相容的问题？

1. 要不要拆分成两个子问题，做两个方案。结合目前了解到的信息，这个结论很大概率是对的。
2. 环比 + 同比：一个策略检测环比（检测突升突降），一个策略检测同比（屏蔽周期性告警）。
3. 检测突升突降要考虑到时间上的秩序感，ma肯定没有ewma效果好。
4. 可以试一下，ewma局部 + 同比屏蔽周期告警 的组合 策略应该可以。


## 需求还是方案？

怎么给一个合适的阈值？怎么给一个合适的窗口？

这个是一个需求？（用户定）还是一个解决方案？（我们可给出最佳实践）

按照经验，怎么确定阈值？

怎么确定异常？偏离正常的就是异常，不合群的 极少数 就是异常，like me

- 如果这个群体就是一个五花八门的， 那么很难说哪一个是异常，因为都很有个性。eg美国的拉美裔，女权团体。
- 如果一个群体在整体上是有秩序的，只有少部分个体表现的不符合这个秩序，这些人就是异常。

## 怎么确定个体是不是某个群体的异类呢？

1. 先判断群体的属性，有没有秩序？有秩序的话，是什么类型的秩序？
2. 如果没有秩序，说明，单纯的数据挖掘，获取不到可信的知识。就像做图像分类，本来给的一堆动物世界中的动物做训练，然后测试的时候，给了模型一个孙悟空，模型就不认识了。这个时候，教给算法做不是很合理，应该转交给更高级的人类去处理，他有领域知识，比机器聪明。
3. 如果有秩序，去对比。异常会涉及到进一步的异常细分。

## 自己作为方法

1. 用预测的方法，去做曲线模式判断，用拟合程度来判断符合哪个模式，即找到最佳视角能够解释这个现象
2. 将1中的视角选中，采用历史外推的方式，估算出正常区间，
3. 更进一步的，正常区间之外，想要找出某个类型的异常，就再次配置出异常类型。

## 一些实践

1. 【均值回归策略】使用邻近窗口的高斯检测器，要注意，这个方法忽略了时间序列的趋势性。
2. 【趋势策略】使用ewma，或者曲线拟合出趋势，都可以。


