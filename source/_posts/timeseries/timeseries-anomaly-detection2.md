---
title: 时序异常检测的技术和应用_2
date: 2021-02-22 09:49:20
author: "chiechie"
subtitle: "给出具体的方案的整体规划"
header-style: text
categories: 技术类
tags:
  - 时间序列
  - 统计
  - 量化交易
  - 异常检测
---

## 有经验的算法工程师怎么做异常检测？
考虑到实际情况，当用户接手了一堆监控指标，他怎么构建合理的监控方案呢？
大概思路是，第一步将需求标准化，第二步将需求映射为解决方案。

先提出几个论断
### 几个论断
1. 需求和方案是多对多的关系：一个需求会对应1个或者多个解决方案。
2. 定义曲线正常模式是一个多标签的问题：。
3. 定义异常类型是一个多标签的问题，可定义多个类型的异常。
4. 一个异常可能同时属于好几类异常。比如属于全局异常的一定是局部异常。

### 需求标准化 
需求标准化，可以从两个角度入手：
1. 识别曲线的正常模式-- 数据驱动 + 人工经验（可选）。
2. （可选）指定特殊的异常模式--人工配置，以易懂的方式配置，平台映射成识别的代码；也可吧吧配置，就全部检测出来。

另外，基于接入数据的元信息，可以直接进行标准化。
比如成功率指标，需求标准化为 ：
1. 正常模式：比率型曲线
2. 异常模式：下降类型的异常

### 解决方案

解决方案大致分为几个类型
- 概率模型：高斯模型/...
- 时序预测：prophet/stl/DeepAR/...
- 有监督异常检测模型：样本标记 + 特征构造 +分类算法

从需求到方案的映射:
可以采取过滤 + 自动筛选的方式


## 平台方将这个算法人员的经验产品化？
### 需求标准化
从以下几个维度对需求去做标准化
- 曲线的正常模式：多标签，每个维度给出一个分值，相当于画像
  - 连续性: 连续型/有规律间断/无规律间断型
  - 周期性：daily/weekly
  - 趋势型：平稳型/线性趋势/s型
- 曲线的异常模式：多标签，可选1个或者多个
  - 全局异常（Global Outliers）：上升/下降
  - 上下文异常（Contextual Outliers）：突变点/违背周期性&上升/下降
  - 序列异常（Collective Outliers， 单个点不异常，放到一起就很异常）：片段波动率异常/...
  - 趋势异常：趋势超过某个thresh-跟人工设定标准比
- 工程需求：
  - 支持冷启动: 历史数据不够，要求快速检测
  - 没有标记样本：
  - 要求低延时：


### 解决方案映射

对于特定的需求，给一个可选方案的范围，排除明显不合适的方案。
但是哪个方案最优呢？平台要提供自动化的评估方法，比如注入异常，提供标准化的评估数据。---这个要再深入调研下

https://docs.qq.com/sheet/DVFhYcVJyaWtrWllr?tab=BB08J2

![curve_adapter.png](/images/curve_adapter.png)


## 最终的整体方案
![general_tsad_framework.png](/images/general_tsad_framework.png)