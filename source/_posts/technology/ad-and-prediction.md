---
title: 预测和异常检测
author: chiechie
mathjax: true
date: 2021-04-01 23:12:28
tags:
- 时间序列
- 不相容需求
- 趋势回归
- 视角主义
categories:
- 技术
---

> 一些reflection

## 公理

1. 什么是异常？不合群的 极少数 就是异常
	- 如果这个群体就是一个五花八门的, 很难说哪个异常，因为都很有个性。eg美国的拉美裔，女权团体。
	- 如果这个群体mostly有秩序，只有少部分个体表现的不符合这个秩序，这些人就是异常。

1. 异常检测比预测更简单。异常检测只需自圆其说即可，时序预测需要拿现实数据来验证。
2. 异常检测分两步，先做模式识别，也就是找规律，然后判断当前数据是否符合规律，符合即正常，反之则为异常。


## 推论

1. 异常检测只需要告知自己理解是啥；预测需要更进一步，考虑现实中的所有可能发生的情况。异常检测可以大胆地做，理论上没法证伪。预测是企业家的事情，需要一比高下。做异常检测是学术界的事情，选定一个视角，自己得出结论，不用跟别人一比高下。
2. 异常检测的原理是历史外延，没法证伪。如果预测和现实有偏差，碰巧能找到故障。如果找不到，也有可能是隐患，或者我们的视角有局限。没法证明是误判。
3. 一种异常检测器是一种视角，应该允许存在多个视角，并且可自由切换。
8. 什么样的告警结果用户可接受？符合他们认知的，比如同环比，上下界。


## 时间序列和iid样本

1. 时间序列相对于iid样本，生成机制不一样。时间序列比如人在不同时刻的行为序列，是有延续的。iid的数据比如，体育彩票，每一期中奖号码跟上一期没有关系。
2. iid的样本，符合中心极限定理。时间序列分布就没有这么简单，样本之间的关系还粘粘乎乎的。
3. 简单粗暴地将CLT套到时间序列上面行不行？即，如果新来的样本点不满足历史正态分布，就是异常。
不行，有两个反例：

	- 反例1：新来的样本不满足正态分布，但是正常--周期性凸起
	- 反例2：新来的样本满足正态分布，但是异常--局部拐点

4. 还是想补救一下，能不能认为，排除掉了周期性凸起和局部拐点之后，就满足CLT了？或者切换到一个更简单清晰的视角，不用CLT，而是从时间序列的模式出发？like stl模式：假设时间序列是由周期性 + 趋势性 + 高斯噪声 三部分组成。在历史数据中分解出这3种模式。假设趋势性保持，周期性往复，高斯噪声依旧无规律，生成一个预测区间。然后拿新样本去对比。

	> 需求验证 1. 能否将周期性凸起屏蔽掉， 2. 能否告出局部拐点
	>
	> 我猜测1和2都不行，1的话因为周期性凸起一般波动非常大，算法很难精准拟合，毕竟要照顾其他大部分平庸之辈的拟合程度，2是因为因为给的置信区间太大了局部拐点告不出来。。




## 周期性凸起和局部拐点是不是两个不相容的问题？

1. 要不要拆分成两个子问题，做两个方案:环比 + 同比.一个策略检测环比（检测突升突降），一个策略检测同比（屏蔽周期性告警）。
3. 检测突升突降要考虑到时间上的秩序感，ma肯定没有ewma效果好。
4. ewma局部 + 同比屏蔽周期告警 的组合 策略可以，验证过了。


## 需求还是方案？

怎么给一个合适的阈值？怎么给一个合适的窗口？

这个是一个需求？（用户定）还是一个解决方案？（我们给最佳实践）


## 怎么确定个体是不是某个群体的异类呢？

1. 先判断群体的属性，有没有秩序？有秩序的话，是什么类型的秩序？
2. 如果没有秩序，说明，单纯的数据挖掘，获取不到可信的知识。就像做图像分类，本来给的一堆动物世界中的动物做训练，然后测试的时候，给了一个孙悟空，模型就不认识了。这种任务就不应该交给算法，应该转交给更高级的人类去处理，他有领域知识，比机器聪明。
3. 如果有秩序，去对比。异常会涉及到进一步的异常细分。

## 自己作为方法

1. 用预测的方法，去做曲线模式判断，用拟合程度来判断符合哪个模式，即找到最佳视角能够解释这个现象
2. 将1中的视角选中，采用历史外推的方式，估算出正常区间，
3. 更进一步的，正常区间之外，想要找出某个类型的异常，就再次配置出异常类型。

## 一些实践

1. 使用邻近窗口的高斯检测器，要注意，这个方法忽略了时间序列的趋势性。
2. 使用ewma，或者曲线拟合出趋势，都可以弥补1的问题。


